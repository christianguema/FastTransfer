{% extends "../partials/base.html" %}

{% load static %}

{% block content %}

<div class="mx-auto max-w-(--breakpoint-2xl) p-4 pb-20 md:p-6 md:pb-6">
    <div class="space-y-6">
        <!-- Page Title -->
        <div class="rounded-2xl border border-gray-200 bg-white p-5 dark:border-gray-800 dark:bg-white/[0.03]">
            <h3 class="text-lg font-semibold text-gray-800 dark:text-white">
                HISTORIQUE DES TRANSACTIONS
            </h3>
        </div>

        <!-- DEPOSITS Section -->
        <div class="rounded-2xl border border-gray-200 bg-white p-5 dark:border-gray-800 dark:bg-white/[0.03]">
            <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">
                Dépôts
            </h3>
            <div class="overflow-x-auto">
                <table class="w-full table-auto border-collapse">
                    <thead>
                        <tr>
                            <th class="border-b px-4 py-2 text-left text-sm font-medium text-gray-700 dark:text-gray-300">Référence</th>
                            <th class="border-b px-4 py-2 text-left text-sm font-medium text-gray-700 dark:text-gray-300">Date</th>
                            <th class="border-b px-4 py-2 text-left text-sm font-medium text-gray-700 dark:text-gray-300">Montant (FCFA)</th>
                            <th class="border-b px-4 py-2 text-left text-sm font-medium text-gray-700 dark:text-gray-300">Statut</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if deposits %}
                            {% for deposit in deposits %}
                            <tr>
                                <td class="border-b px-4 py-2 text-sm text-gray-600 dark:text-gray-300">{{ deposit.reference }}</td>
                                <td class="border-b px-4 py-2 text-sm text-gray-600 dark:text-gray-300">{{ deposit.created_at|date:"d/m/Y" }}</td>
                                <td class="border-b px-4 py-2 text-sm text-green-600 dark:text-green-400 font-medium">+{{ deposit.amount }} FCFA</td>
                                <td class="border-b px-4 py-2 text-sm text-gray-600 dark:text-gray-300">
                                    {% if deposit.status == "SUCCESS" %}<span class="px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700">Complété</span>
                                    {% elif deposit.status == "PENDING" %}<span class="px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-700">En attente</span>
                                    {% else %}<span class="px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-700">Échoué</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="4" class="px-4 py-2 text-sm text-gray-600 dark:text-gray-300 text-center">Aucun dépôt.</td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- TRANSFERS Section -->
        <div class="rounded-2xl border border-gray-200 bg-white p-5 dark:border-gray-800 dark:bg-white/[0.03]">
            <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">
                Transferts
            </h3>
            <div class="overflow-x-auto">
                <table class="w-full table-auto border-collapse">
                    <thead>
                        <tr>
                            <th class="border-b px-4 py-2 text-left text-sm font-medium text-gray-700 dark:text-gray-300">Référence</th>
                            <th class="border-b px-4 py-2 text-left text-sm font-medium text-gray-700 dark:text-gray-300">Date</th>
                            <th class="border-b px-4 py-2 text-left text-sm font-medium text-gray-700 dark:text-gray-300">Destinataire</th>
                            <th class="border-b px-4 py-2 text-left text-sm font-medium text-gray-700 dark:text-gray-300">Montant (FCFA)</th>
                            <th class="border-b px-4 py-2 text-left text-sm font-medium text-gray-700 dark:text-gray-300">Statut</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if transfers %}
                            {% for transfer in transfers %}
                                {% if transfer.sender_account.id == request.user.accountowner.virtualaccount.id %}
                                    {% with counterpart=transfer.receiver_account %}
                                    <tr>
                                        <td class="border-b px-4 py-2 text-sm text-gray-600 dark:text-gray-300">{{ transfer.reference }}</td>
                                        <td class="border-b px-4 py-2 text-sm text-gray-600 dark:text-gray-300">{{ transfer.created_at|date:"d/m/Y" }}</td>
                                        <td class="border-b px-4 py-2 text-sm text-gray-600 dark:text-gray-300">{{ counterpart.owner.owner.first_name }} {{ counterpart.owner.owner.last_name }}</td>
                                        <td class="border-b px-4 py-2 text-sm text-red-600 dark:text-red-400 font-medium">-{{ transfer.amount }} FCFA</td>
                                        <td class="border-b px-4 py-2 text-sm text-gray-600 dark:text-gray-300">
                                            {% if transfer.status == "SUCCESS" %}<span class="px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700">Complété</span>
                                            {% elif transfer.status == "PENDING" %}<span class="px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-700">En attente</span>
                                            {% else %}<span class="px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-700">Échoué</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endwith %}
                                {% else %}
                                    {% with counterpart=transfer.sender_account %}
                                    <tr>
                                        <td class="border-b px-4 py-2 text-sm text-gray-600 dark:text-gray-300">{{ transfer.reference }}</td>
                                        <td class="border-b px-4 py-2 text-sm text-gray-600 dark:text-gray-300">{{ transfer.created_at|date:"d/m/Y" }}</td>
                                        <td class="border-b px-4 py-2 text-sm text-gray-600 dark:text-gray-300">{{ counterpart.owner.owner.first_name }} {{ counterpart.owner.owner.last_name }}</td>
                                        <td class="border-b px-4 py-2 text-sm text-green-600 dark:text-green-400 font-medium">+{{ transfer.amount }} FCFA</td>
                                        <td class="border-b px-4 py-2 text-sm text-gray-600 dark:text-gray-300">
                                            {% if transfer.status == "SUCCESS" %}<span class="px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700">Complété</span>
                                            {% elif transfer.status == "PENDING" %}<span class="px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-700">En attente</span>
                                            {% else %}<span class="px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-700">Échoué</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endwith %}
                                {% endif %}
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="5" class="px-4 py-2 text-sm text-gray-600 dark:text-gray-300 text-center">Aucun transfert.</td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- WITHDRAWALS Section -->
        <div class="rounded-2xl border border-gray-200 bg-white p-5 dark:border-gray-800 dark:bg-white/[0.03]">
            <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">
                Retraits
            </h3>
            <div class="overflow-x-auto">
                <table class="w-full table-auto border-collapse">
                    <thead>
                        <tr>
                            <th class="border-b px-4 py-2 text-left text-sm font-medium text-gray-700 dark:text-gray-300">Référence</th>
                            <th class="border-b px-4 py-2 text-left text-sm font-medium text-gray-700 dark:text-gray-300">Date</th>
                            <th class="border-b px-4 py-2 text-left text-sm font-medium text-gray-700 dark:text-gray-300">Montant (FCFA)</th>
                            <th class="border-b px-4 py-2 text-left text-sm font-medium text-gray-700 dark:text-gray-300">Frais (FCFA)</th>
                            <th class="border-b px-4 py-2 text-left text-sm font-medium text-gray-700 dark:text-gray-300">Montant Net (FCFA)</th>
                            <th class="border-b px-4 py-2 text-left text-sm font-medium text-gray-700 dark:text-gray-300">Statut</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if withdrawals %}
                            {% for withdrawal in withdrawals %}
                            <tr>
                                <td class="border-b px-4 py-2 text-sm text-gray-600 dark:text-gray-300">{{ withdrawal.reference }}</td>
                                <td class="border-b px-4 py-2 text-sm text-gray-600 dark:text-gray-300">{{ withdrawal.created_at|date:"d/m/Y" }}</td>
                                <td class="border-b px-4 py-2 text-sm text-red-600 dark:text-red-400 font-medium">-{{ withdrawal.amount }} FCFA</td>
                                <td class="border-b px-4 py-2 text-sm text-orange-600 dark:text-orange-400">{{ withdrawal.fee }} FCFA</td>
                                <td class="border-b px-4 py-2 text-sm text-red-600 dark:text-red-400 font-medium">-{{ withdrawal.net_amount }} FCFA</td>
                                <td class="border-b px-4 py-2 text-sm text-gray-600 dark:text-gray-300">
                                    {% if withdrawal.status == "SUCCESS" %}<span class="px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700">Complété</span>
                                    {% elif withdrawal.status == "PENDING" %}<span class="px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-700">En attente</span>
                                    {% else %}<span class="px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-700">Échoué</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="6" class="px-4 py-2 text-sm text-gray-600 dark:text-gray-300 text-center">Aucun retrait.</td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>

{% endblock %}